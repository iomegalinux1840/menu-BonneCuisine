<% if @menu_item.errors.any? %>
  <div class="alert alert-error">
    <h4><%= pluralize(@menu_item.errors.count, "erreur") %> empêche la sauvegarde :</h4>
    <ul>
      <% @menu_item.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
    </ul>
    <% if @menu_item.errors[:image].any? %>
      <p><strong>Erreur d'image:</strong> <%= @menu_item.errors[:image].join(', ') %></p>
    <% end %>
  </div>
<% end %>

<div class="form-grid">
  <div class="form-group">
    <%= form.label :name, "Nom du plat", class: "form-label" %>
    <%= form.text_field :name, class: "form-input", required: true %>
  </div>

  <div class="form-group">
    <%= form.label :price, "Prix ($)", class: "form-label" %>
    <%= form.number_field :price, step: 0.01, min: 0, class: "form-input", required: true %>
  </div>

  <div class="form-group full-width">
    <%= form.label :description, "Description", class: "form-label" %>
    <%= form.text_area :description, rows: 3, class: "form-textarea",
          placeholder: "Décrivez les ingrédients et la préparation..." %>
  </div>

  <div class="form-group full-width">
    <%= form.label :comment, "Commentaire (allergies, suggestions...)", class: "form-label" %>
    <%= form.text_area :comment, rows: 2, class: "form-textarea",
          placeholder: "Informations supplémentaires pour les clients..." %>
  </div>

  <div class="form-group full-width">
    <%= form.label :image, "Photo du plat", class: "form-label" %>
    <%= form.file_field :image, accept: "image/*", class: "form-input", capture: "environment" %>
    <% begin %>
      <% if @menu_item.image.attached? %>
        <div class="current-image">
          <p><strong>Image actuelle:</strong></p>
          <%= image_tag @menu_item.image, class: "menu-item-thumb" %>
        </div>
      <% end %>
    <% rescue => e %>
      <div class="current-image">
        <p><strong>Erreur d'affichage de l'image actuelle</strong></p>
      </div>
    <% end %>
    <small class="form-help">Formats acceptés: JPG, PNG, GIF, WebP (max 5MB)</small>
  </div>

  <div class="form-group">
    <%= form.label :position, "Position dans le menu", class: "form-label" %>
    <%= form.number_field :position, min: 1, class: "form-input" %>
    <small class="form-help">Les autres plats seront automatiquement réorganisés</small>
  </div>

  <div class="form-group">
    <div class="checkbox-group">
      <%= form.check_box :available, class: "form-checkbox" %>
      <%= form.label :available, "Plat disponible", class: "form-label checkbox-label" %>
    </div>
  </div>
</div>

<div class="form-actions">
  <%= form.submit (@menu_item.new_record? ? "Créer le plat" : "Mettre à jour le plat"),
        class: "btn btn-primary",
        onclick: "console.log('Form submitted'); return true;" %>
  <%= link_to "Annuler", restaurant_admin_menu_items_path(restaurant_slug: params[:restaurant_slug]), class: "btn btn-outline" %>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.querySelector('form');
  if (form) {
    console.log('Form found, enctype:', form.enctype);

    form.addEventListener('submit', function(e) {
      console.log('=== FORM SUBMIT START ===');
      console.log('Form action:', form.action);
      console.log('Form method:', form.method);
      console.log('Form enctype:', form.enctype);

      const formData = new FormData(form);
      console.log('Form data keys:', Array.from(formData.keys()));

      const imageInput = form.querySelector('input[type="file"]');
      if (imageInput && imageInput.files.length > 0) {
        console.log('Image file selected:', imageInput.files[0].name, 'Size:', imageInput.files[0].size, 'Type:', imageInput.files[0].type);
        console.log('Image input name:', imageInput.name);
      } else {
        console.log('No image file selected');
      }

      console.log('Authenticity token present:', formData.has('authenticity_token'));
      console.log('=== FORM SUBMIT END ===');
    });

    // Also log when form is created
    console.log('Form initialized with multipart:', form.enctype.includes('multipart'));
  } else {
    console.log('Form not found');
  }
});
</script>